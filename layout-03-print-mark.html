<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>layout</title>
    <!-- Material -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <!-- <link rel="stylesheet" href="/material/material-icons-ie.css">
    <link rel="stylesheet" href="/material/material-icons.css"> -->
    <!-- element-plus -->
    <!-- <link rel="stylesheet" href="/unpkg.com/element-plus/dist/index.css" /> -->
    <!-- tabulator -->
    <link rel="stylesheet" href="/tabulator/tabulator-master/dist/css/tabulator.min.css">
    <script type="text/javascript" src="/tabulator/tabulator-master/dist/js/tabulator.min.js"></script> 
    <!-- 以我的為主 -->
    <!-- 有外框線 阿寶用 -->
    <!-- <link rel="stylesheet" href="css/type-frame-border.css"> -->
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/jquery-ui.theme.css">
    <link rel="stylesheet" href="css/type-frame.css">
    <link rel="stylesheet" href="css/type-frame-color.css">
    <link rel="stylesheet" href="css/tabulator_ment.css">
</head>
<body>
    <div class="container">
        <div class="left-clumn">
            <div class="left-clumn-item_logo">
                <a href="#"><img src="./img/item_logo.png" alt=""></a>
            </div>
            <div class="left-clumn-row">
                <div class="title">佣金作業</div>
            </div>
            <div class="left-clumn-row">
                <a href="#"><span class="materialSize material-icons-outlined">description</span><div class="secList">要保書作業</div></a>
            </div>
            <div class="left-clumn-row">
                <a href="#"><span class="materialSize material-icons-outlined">list_alt</span><div class="secList">批單及保單作業</div></a>
            </div>
            <div class="left-clumn-row">
                <a href="#"><span class="materialSize material-icons-outlined">paid</span><div class="secList">獎金佣金報表</div></a>
            </div>
        </div>
        <div class="right-clumn">
            <div class="right-clumn-row">
                <ul class="lifteflex">
                    <div class="columnFour">
                        <div class="workShop">
                            <ul>
                                <li><a href="#" class="unittab-active">佣金作業</a></li>
                                <li><a href="#">法遵稽核</a></li>
                                <li><a href="#">角色權限</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="columnFive-right">
                        <div class="workName">
                            <ul>
                                <li>和安保代：<span>廖家祥</span></li>
                                <li>行政專員<span class="workCode">A123456</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="columnTen-right">
                        <div class="logOut">
                            <button>登出</button>
                            <span class="materialSize-s material-icons-outlined">logout</span>
                        </div>
                    </div>
                </ul>
            </div>
            <div class="right-clumn-row">
                <div class="breadCrumb">
                    <span class="materialSize-m-r material-icons-outlined">location_on</span>
                    <!-- &nbsp;不換行空格 -->
                    <a href="#">佣金作業</a>&nbsp;/&nbsp;<a href="#">獎金佣金報表</a> 
                </div>
            </div>
            <div class="right-clumn-row">
                <h1 class="unitH1">獎金佣金報表</h1>
            </div>
            <div class="title-button-group">
                <button class="btn-title">上傳</button>
                <button class="btn-title">對帳</button>
                <button class="btn-title">結算</button>
                <button class="btn-title btn-title-active">明細列印</button>
            </div>
            <div class="right-clumn-row">
                <div class="query-unit">
                    <div class="listcheck-button-group">
                        <button class="btn btn-listcheck"><span class="material-icons-outlined">
                            check_circle
                            </span>帳期</button>
                    </div>
                    <hr>
                    <div class="content-unit">
                        <div class="query-unit-group">
                            <div class="query-unit-title">帳期</div>
                            <div class="query-unit-input">
                                <div class="query-unit-double-input">
                                    <div class="columnFive-left-37">
                                    <input type="date" value="" placeholder="請輸入值">
                                    </div>
                                    <span class="zigzagLine">～</span>
                                    <div class="columnFive-left-37">
                                        <input type="date" value="" placeholder="請輸入值">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="query-unit-body">
                    <div class="right-clumn-row">
                        <div class="pop-table-header">
                            <div class="query-unit-infolist">
                                結算代號共<span>12</span>項資料
                            </div>
                        </div>
                        <div class="pop-table-body">
                            <ul>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109001
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109002
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109003
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109004
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109005
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109006
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109007
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109008
                                    </label>
                                </li>
                            </ul>
                            <ul>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109009
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109010
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109011
                                    </label>
                                </li>
                                <li>
                                    <label class="pop-table-label">
                                        <div class="pop-table-label-input"><input type="checkbox" value="">
                                        </div>FB20221109012
                                    </label>
                                </li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="query-unit-body">
                    <div class="query-unit-group-3">
                        <div class="query-unit-title">單位別</div>
                        <div class="query-unit-input-2 ">
                            <label for=""><input type="checkbox" value="全部">全部</label>
                            <label for=""><input type="checkbox" value="台北">台北</label>
                            <label for=""><input type="checkbox" value="台中">台中</label>
                            <label for=""><input type="checkbox" value="台南">台南</label>
                            <label for=""><input type="checkbox" value="高雄">高雄</label>
                        </div>
                    </div>
                    <hr class="case">
                    <div>
                        <button class="btn btn-list">二代健保身份</button>
                        <button class="btn btn-list">變更承攬人</button>
                    </div>
                        <div class="upload-tabulate-header">
                            <ul>
                                <li><a href="">下載</a></li>
                                <li><a href="">刪除</a></li>
                            </ul>
                        </div>
                        <div class="upload-tabulate">
                            <div id="table02"></div>
                            <div class="tablePage">
                                <ul>
                                    <li><button class="btn btn-prev">上一頁</button></li>
                                    <li><button class="btn btn-next">下一頁</button></li>
                                    <li class="bulenote">每頁筆數</li>
                                    <li>
                                        <select name="" id="">
                                            <option value="">1000</option>
                                            <option value="">2</option>
                                            <option value="">3</option>
                                        </select>
                                    </li>
                                    <li class="bulenote">目前頁數</li>
                                    <li>
                                        <select name="" id="">
                                            <option value="">1000</option>
                                            <option value="">2</option>
                                            <option value="">3</option>
                                        </select>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="upload-tabulate-footer"></div>
                </div>
                <div class="query-unit-info">
                    <div class="query-unit-infolist">
                        共<span>12</span>項資料
                    </div>
                    <div class="query-unit-infobutton">
                        <button class="btn btn-clear">清除</button>
                        <button class="btn btn-search">搜尋</button>
                    </div>
                </div>

            </div>
            <hr>
        </div>
    </div>
</body>
</html>

<script>
let nestedData = [{
    id: "a1",
    批號: "123456",
    賠案號碼: "賠案號碼",
    收款人: "收款人",
    賠付金額: "賠付金額",
    票號: "票號",
    付款別: "付款別",
    到期日: "到期日",
    帳號: "帳號",
    狀態: "狀態",
    ntTable: [
        { 收款人: "001193-吳孟哲", 應付金額: "500", 賠案號碼: "90870169" },
        { 收款人: "001193-吳孟哲", 應付金額: "337", 賠案號碼: "90870170" },
    ]
}, ]

var table = new Tabulator("#table02", {
    height: "100%",
    layout: "fitColumns",
    movableColumns: true,
    data: nestedData,
    columns: [{
            formatter: "rowSelection",
            titleFormatter: "rowSelection",
            headerHozAlign: "center",
            hozAlign: "center",
            headerSort: false,
            maxWidth: 30,
            minWidth: 30,
            cellClick: function(e, cell) {
                cell.getRow().toggleSelect();
            }
        },
        {
            formatter: (cell, formatterParams, onRendered) => {
                let div = document.createElement('div');
                let el = cell.getRow().getElement()
                let btnName = ["＋", "–"]

                btnName.forEach((name, index) => {
                    let btn = document.createElement('button');
                    $(btn).text(name)
                    elementsChangeClass(btn, "add", "table-btn-switch")
                    btn.addEventListener("click", (e) => {
                        $(el).find(".table-btn-switch").toggle()
                        $(el).find(".table-subtable-container").toggle()
                    });
                    if (index === 1) {
                        $(btn).css("display", "none")
                    }
                    div.appendChild(btn)
                })
                return div
            },
            headerHozAlign: "center",
            hozAlign: "center",
            headerSort: false,
            maxWidth: 30,
            minWidth: 30
        },
        {
            title: "批號",
            field: "批號",
            formatter: function(cell, formatterParams, onRendered) {
                return "<a href='#'>" + cell.getValue() + "</a>"
            },
            // formatter: "link",
        },
        { title: "賠案號碼", field: "賠案號碼" },
        { title: "收款人", field: "收款人" },
        { title: "賠付金額", field: "賠付金額" },
        { title: "票號", field: "票號" },
        { title: "付款別", field: "付款別" },
        { title: "到期日", field: "到期日" },
        { title: "帳號", field: "帳號" },
        { title: "狀態", field: "狀態" },
    ],
    rowFormatter: function(row) {
        let container = document.createElement("div");
        let subtable = document.createElement("div");

        $(container).css("display", "none")
        elementsChangeClass(container, "add", "table-subtable-container")
        elementsChangeClass(subtable, "add", "table-subtable")
        $(subtable).attr("id", row.getData().id)

        container.appendChild(subtable);
        row.getElement().appendChild(container);

        let subTable = new Tabulator("#" + row.getData().id, {
            layout: "fitColumns",
            data: row.getData().ntTable,
            columns: [
                { title: "收款人", field: "收款人" },
                { title: "應付金額", field: "應付金額" },
                { title: "賠案號碼", field: "賠案號碼" },
            ]
        })
    },
});

function elementsChangeClass(elements, behavior, classNames) {
    if (behavior === "add") {
        $(elements).each(function(index, element) {
            $(element).addClass(classNames)
        })
    } else if (behavior === "remove") {
        $(elements).each(function(index, element) {
            $(element).removeClass(classNames)
        })
    }
}
</script>